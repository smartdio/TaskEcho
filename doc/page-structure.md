# TaskEcho 功能页面结构设计文档

## 1. 主要功能页面

### 1.1 首页（Home Page）
**路由**：`/`

**功能描述**：
- 展示所有项目的列表
- 显示全局统计数据
- 作为应用的入口页面

**核心内容**：
- **项目列表区域**
  - 项目卡片列表，按最后任务更新时间倒序排列
  - 每个项目卡片显示：
    - 项目名称
    - 项目下的任务队列数量
    - 项目下的任务总数统计（总数/Pending/Done/Error）
    - 最后更新时间
- **全局统计区域**
  - 总任务数
  - Pending 任务数
  - Done 任务数
  - Error 任务数
- **顶部导航栏**
  - 应用标题/Logo
  - 设置入口（跳转到 API Key 管理页面）
  - 主题切换按钮（深浅色模式）

**交互功能**：
- 点击项目卡片 → 跳转到项目详情页
- 点击设置图标 → 跳转到 API Key 管理页面
- 点击主题切换按钮 → 切换深浅色模式

---

### 1.2 项目详情页（Project Detail Page）
**路由**：`/project/:projectId`

**功能描述**：
- 展示单个项目下的所有任务队列
- 提供任务队列的搜索和浏览功能

**核心内容**：
- **页面头部**
  - 面包屑导航：首页 > 项目名称
  - 项目名称标题
  - 返回首页按钮
- **搜索区域**
  - 任务队列名称搜索输入框
  - 实时搜索过滤
- **任务队列列表区域**
  - 任务队列卡片列表
  - 每个任务队列卡片显示：
    - 队列名称
    - 任务数量统计（总数/Pending/Done/Error）
    - 最后更新时间
    - 任务状态分布可视化（可选）

**交互功能**：
- 点击任务队列卡片 → 跳转到任务队列详情页
- 输入搜索关键词 → 实时过滤任务队列列表
- 点击返回按钮 → 返回首页

---

### 1.3 任务队列详情页（Queue Detail Page）
**路由**：`/project/:projectId/queue/:queueId`

**功能描述**：
- 展示单个任务队列下的所有任务
- 提供任务的过滤和浏览功能

**核心内容**：
- **页面头部**
  - 面包屑导航：首页 > 项目名称 > 队列名称
  - 队列名称标题
  - 返回项目详情页按钮
- **过滤区域**
  - 标签过滤：显示所有可用标签，支持多选
  - 状态过滤：Pending / Done / Error 单选或全选
  - 清除过滤按钮
- **任务列表区域**
  - 任务卡片列表
  - 每个任务卡片显示：
    - 任务标题
    - 标签列表（多标签彩色展示）
    - 状态徽章（Pending/Done/Error）
    - 最后更新时间
    - 对话消息数量（可选）

**交互功能**：
- 点击任务卡片 → 跳转到任务详情页
- 选择标签 → 过滤显示包含该标签的任务
- 选择状态 → 过滤显示对应状态的任务
- 点击清除过滤 → 重置所有过滤条件
- 点击返回按钮 → 返回项目详情页

---

### 1.4 任务详情页（Task Detail Page）
**路由**：`/project/:projectId/queue/:queueId/task/:taskId`

**功能描述**：
- 展示任务的完整对话历史
- 展示任务的执行日志
- 提供回复输入功能

**核心内容**：
- **页面头部**
  - 面包屑导航：首页 > 项目名称 > 队列名称 > 任务标题
  - 任务标题
  - 任务状态徽章
  - 任务标签列表
  - 返回任务队列详情页按钮
- **对话区域**
  - 对话消息列表（用户 ↔ AI 多轮对话）
  - 每条消息显示：
    - 角色标识（用户/AI）
    - 消息内容（支持 Markdown 渲染）
    - 代码块高亮显示
    - 时间戳
  - 消息按时间正序排列
- **日志区域**
  - 日志标题
  - 日志列表（倒序展示，最新的在上方）
  - 每条日志显示：
    - 时间戳
    - 日志内容（纯文本）
- **回复输入区域**（固定在页面底部）
  - 多行文本输入框
  - 发送按钮
  - 字符计数（可选）

**交互功能**：
- 发送回复 → 在对话区域追加一条用户消息（仅本地保存）
  - 输入框清空
  - 页面滚动到底部显示新消息
  - 不触发任何外部 API 调用
- 点击返回按钮 → 返回任务队列详情页
- 对话区域滚动 → 支持查看历史消息
- 代码块复制 → 支持复制代码块内容（可选）

---

### 1.5 API Key 管理页面（Settings Page）
**路由**：`/settings`

**功能描述**：
- 管理项目的 API Key
- 提供 API Key 的增删改功能

**核心内容**：
- **页面头部**
  - 页面标题：API Key 管理
  - 返回首页按钮
- **API Key 列表区域**
  - API Key 列表表格
  - 每行显示：
    - API Key 名称/标识
    - API Key 值（部分隐藏显示，如：`sk-****1234`）
    - 关联的项目 ID（可选）
    - 创建时间
    - 操作按钮（编辑、删除）
- **添加 API Key 区域**
  - 添加按钮
  - 点击后显示表单：
    - API Key 名称（必填）
    - API Key 值（必填）
    - 关联项目 ID（可选）
    - 保存按钮、取消按钮

**交互功能**：
- 点击添加按钮 → 显示添加表单
- 点击编辑按钮 → 显示编辑表单（预填充数据）
- 点击删除按钮 → 显示确认对话框 → 确认后删除
- 点击保存按钮 → 保存 API Key（新增或更新）
- 点击取消按钮 → 关闭表单
- API Key 值显示/隐藏切换（可选）

---

### 1.6 404 页面（Not Found Page）
**路由**：`/404` 或任意未匹配路由

**功能描述**：
- 处理未找到的页面路由

**核心内容**：
- 404 错误提示
- 返回首页按钮

**交互功能**：
- 点击返回首页按钮 → 跳转到首页

---

## 2. 页面跳转关系图

```
首页 (/)
├── 点击项目卡片
│   └── 项目详情页 (/project/:projectId)
│       ├── 点击任务队列卡片
│       │   └── 任务队列详情页 (/project/:projectId/queue/:queueId)
│       │       ├── 点击任务卡片
│       │       │   └── 任务详情页 (/project/:projectId/queue/:queueId/task/:taskId)
│       │       │       └── 发送回复（本地保存，不跳转）
│       │       └── 返回按钮 → 项目详情页
│       └── 返回按钮 → 首页
│
├── 点击设置图标
│   └── API Key 管理页面 (/settings)
│       └── 返回按钮 → 首页
│
└── 任意未匹配路由
    └── 404 页面 (/404)
        └── 返回首页按钮 → 首页
```

### 2.1 导航层级结构

```
层级 1: 首页
  └── 层级 2: 项目详情页
      └── 层级 3: 任务队列详情页
          └── 层级 4: 任务详情页

独立页面: API Key 管理页面（可从任何页面通过顶部导航进入）
```

---

## 3. 页面交互关系

### 3.1 数据流向

#### 3.1.1 数据获取流程
```
外部系统
  ↓ (POST /api/v1/submit)
后端 API
  ↓ (写入 SQLite)
数据库
  ↓ (查询)
前端页面
  ↓ (展示)
用户界面
```

#### 3.1.2 页面数据更新机制

**首页**：
- 页面加载时：获取所有项目列表和全局统计
- 数据更新：通过轮询或 WebSocket（可选）实时更新项目列表和统计
- 更新触发：当有新项目或项目数据更新时，自动刷新列表

**项目详情页**：
- 页面加载时：根据 `projectId` 获取项目信息和任务队列列表
- 数据更新：实时更新任务队列列表和统计信息
- 搜索过滤：客户端本地过滤，无需重新请求数据

**任务队列详情页**：
- 页面加载时：根据 `projectId` 和 `queueId` 获取任务队列信息和任务列表
- 数据更新：实时更新任务列表
- 过滤功能：客户端本地过滤（标签、状态），无需重新请求数据

**任务详情页**：
- 页面加载时：根据 `projectId`、`queueId`、`taskId` 获取任务完整信息
- 数据更新：实时更新对话消息和日志
- 回复功能：本地追加用户消息，不触发 API 调用

**API Key 管理页面**：
- 页面加载时：获取所有 API Key 列表
- 数据操作：增删改操作直接调用后端 API，成功后刷新列表

### 3.2 状态同步关系

#### 3.2.1 全局状态
- **主题模式**（深浅色）：存储在本地存储（localStorage），所有页面共享
- **API Key 列表**：存储在数据库，所有 API 请求共享

#### 3.2.2 页面状态传递
- **路由参数传递**：
  - `projectId` → 项目详情页、任务队列详情页、任务详情页
  - `queueId` → 任务队列详情页、任务详情页
  - `taskId` → 任务详情页

- **查询参数传递**（可选）：
  - 过滤条件（标签、状态）可通过 URL 查询参数传递，支持分享和书签

#### 3.2.3 数据一致性
- **实时更新**：当后端数据更新时，前端页面自动刷新相关数据
- **缓存策略**：页面数据可适当缓存，但需在数据更新时及时失效
- **乐观更新**：任务详情页的回复功能采用乐观更新策略，立即显示用户消息

### 3.3 用户交互流程

#### 3.3.1 浏览流程
```
用户打开应用
  → 首页（查看所有项目）
  → 点击项目（进入项目详情页）
  → 点击任务队列（进入任务队列详情页）
  → 点击任务（进入任务详情页）
  → 查看对话和日志
  → 可选：发送回复
```

#### 3.3.2 搜索/过滤流程
```
项目详情页
  → 输入搜索关键词
  → 实时过滤任务队列列表（客户端过滤）

任务队列详情页
  → 选择标签过滤
  → 选择状态过滤
  → 实时过滤任务列表（客户端过滤）
  → 点击清除过滤 → 重置所有过滤条件
```

#### 3.3.3 回复流程
```
任务详情页
  → 滚动到底部
  → 在输入框输入回复内容
  → 点击发送按钮
  → 本地追加用户消息（立即显示）
  → 输入框清空
  → 页面滚动到底部显示新消息
  → 等待外部系统轮询发现新消息
```

#### 3.3.4 API Key 管理流程
```
任意页面
  → 点击设置图标
  → 进入 API Key 管理页面
  → 查看 API Key 列表
  → 可选操作：
      - 添加新 API Key（填写表单 → 保存）
      - 编辑现有 API Key（点击编辑 → 修改 → 保存）
      - 删除 API Key（点击删除 → 确认 → 删除）
  → 返回首页
```

---

## 4. 页面布局结构

### 4.1 通用布局组件

**顶部导航栏**（所有页面共用）：
- 左侧：应用 Logo/标题
- 右侧：设置图标、主题切换按钮

**面包屑导航**（除首页外）：
- 显示当前页面层级路径
- 支持点击跳转到上级页面

**页面容器**：
- 响应式布局，适配手机、平板、桌面
- 统一的页面内边距和最大宽度限制

### 4.2 响应式断点设计

- **移动端**（< 768px）：
  - 单列布局
  - 卡片全宽显示
  - 底部固定回复输入框

- **平板端**（768px - 1024px）：
  - 双列布局（可选）
  - 卡片适当宽度

- **桌面端**（> 1024px）：
  - 多列布局（可选）
  - 内容区域居中，最大宽度限制

---

## 5. 数据交互接口

### 5.1 前端调用后端 API

**获取数据接口**：
- `GET /api/v1/projects` - 获取所有项目列表
- `GET /api/v1/projects/:projectId` - 获取项目详情
- `GET /api/v1/projects/:projectId/queues` - 获取项目下的任务队列列表
- `GET /api/v1/projects/:projectId/queues/:queueId` - 获取任务队列详情
- `GET /api/v1/projects/:projectId/queues/:queueId/tasks` - 获取任务队列下的任务列表
- `GET /api/v1/projects/:projectId/queues/:queueId/tasks/:taskId` - 获取任务详情
- `GET /api/v1/stats` - 获取全局统计信息
- `GET /api/v1/api-keys` - 获取所有 API Key 列表

**数据操作接口**：
- `POST /api/v1/api-keys` - 创建 API Key
- `PUT /api/v1/api-keys/:id` - 更新 API Key
- `DELETE /api/v1/api-keys/:id` - 删除 API Key

**数据推送接口**（外部系统调用）：
- `POST /api/v1/submit` - 提交项目、任务队列和任务数据

### 5.2 实时更新机制（可选）

- **轮询方式**：定时请求数据接口，检查是否有更新
- **WebSocket 方式**：建立 WebSocket 连接，后端推送数据更新通知

---

## 6. 错误处理

### 6.1 页面级错误处理

- **404 错误**：显示 404 页面，提供返回首页链接
- **网络错误**：显示错误提示，提供重试按钮
- **数据加载失败**：显示错误提示，提供刷新按钮

### 6.2 组件级错误处理

- **API 调用失败**：显示错误提示信息（中文）
- **表单验证失败**：在表单字段下方显示错误提示
- **操作失败**：显示操作失败提示，不跳转页面

---

## 7. 性能优化考虑

### 7.1 数据加载优化

- **分页加载**：列表数据支持分页，避免一次性加载大量数据
- **虚拟滚动**：长列表使用虚拟滚动技术，只渲染可见区域
- **懒加载**：图片和代码块支持懒加载

### 7.2 缓存策略

- **API 响应缓存**：适当缓存 API 响应数据，减少重复请求
- **本地存储**：主题模式等用户偏好存储在 localStorage

### 7.3 代码优化

- **代码分割**：按路由进行代码分割，减少初始加载体积
- **组件懒加载**：非关键组件使用懒加载

---

## 8. 可访问性（A11y）考虑

- **键盘导航**：支持键盘操作，Tab 键切换焦点
- **屏幕阅读器**：添加适当的 ARIA 标签
- **颜色对比度**：确保文字和背景颜色对比度符合 WCAG 标准
- **焦点管理**：页面跳转后正确管理焦点位置

---

## 9. 总结

本设计文档定义了 TaskEcho 应用的主要功能页面、页面跳转关系、交互关系和数据流向。所有页面设计遵循需求文档的要求，采用完全只读的界面设计（除任务详情页的回复功能和 API Key 管理功能外），数据完全由外部系统通过 API 推送。

页面结构清晰，导航层级明确，支持响应式布局和深浅色主题切换，为用户提供流畅的使用体验。

